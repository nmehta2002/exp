@startuml



class LQRequest
{
    
}

class LQResult
{

}

class LQMgr
{
    + LQMgr(shared<LQRunner> dispatcher,
            shared_ptr<LQTimeStampKeeper> timeStampKeeper,
            shared_ptr<LQRequestGetter> fetcher)
    ..
    //
    // Notifies the LQMgr, about a hint received from the backend.
    // Expect the LQMgr to start the process of fetching the live queries.
    //
    +void LQPendingHint()
    ==

    ..
    //
    // Submit NewQueries to process via this routine.
    //
    +void NewQueries(vector<shared_ptr<LQRequest>> lqRequests)
    ==

    ..
    //
    // Get the current time stamp to use in check-in message.
    //
    +Timestamp GetCurrentTimeStamp()
    ==

    +void Shutdown()
}


class LQTimeStampKeeper
{
    +void ProcessedQuery(shared_ptr<LQRequest> lqRequest)

    +void NewQueries(vector<shared_ptr<LQRequest>> lqRequests)

    +Timestamp GetFetchTimeStamp()
}

interface LQRunnerEventListener
{
    +CompletedQuery(shared_ptr<LQRequest> lqRequest,
                    shared_ptr<LQResult>  lqResult)

    +CancelledQuery(shared_ptr<LQRequest> lqRequest)
}

interface LQRequestGetterListener
{
    +void NewQueries(vector<shared_ptr<LQRequest>> lqRequests)
}

class LQRequestGetter
{
    + LQRequestGetter(shared_ptr<LQRequestGetterListener> fetchListener)

    + Get(TimeStamp createdAfter)

    -- private data --
     - TimeStamp newestKnownQuery
}


class LQRunner
{
    ..
    //
    // Register a listener to listen on LQRequest completion events.
    //
    +LQRunner(shared_ptr<LQRunnerEventListener> listener)
    ==

    +void Enqueue(shared_ptr<LQRequest> lqRequest)

    ..
    //
    // Cancel queries already scheduled with the Runner.
    // A call to this routine does not gurantee that the query will be cancelled,
    // the query will not be cancelled if its already running.
    //
    +void Cancel(shared_ptr<LQRequest> LQRequest)
    ==

    +void Shutdown()
}

interface LQResultSenderListener
{
    +ResultSent(shared_ptr<LQResult> lqResult)
}

class LQResultSender
{
    +void Enqueue(shared_ptr<LQResult> lqResult)
}

interface Subscriber
{
    +void Notify(event_type, event);
}

LQRequestGetterListener <|-- LQMgr
LQRunnerEventListener <|-- LQMgr
LQResultSenderListener <|-- LQMgr
Subscriber <|-- LQMgr

LQMgr o-- LQTimeStampKeeper
LQMgr o-- LQRunner
LQMgr o-- LQRequestGetter
LQMgr o-- LQResultSender
LQRequestGetterListener o-- LQRequestGetter
LQResultSenderListener o-- LQResultSender


@enduml